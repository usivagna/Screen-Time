<!-- Copyright (c) Microsoft Corporation and Contributors. -->
<!-- Licensed under the MIT License. -->

<Page
    x:Class="ScreenTimeMonitor.Views.ReportsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="using:ScreenTimeMonitor.ViewModels">

    <ScrollViewer>
        <StackPanel Spacing="24" Padding="0,0,0,24">
            
            <!-- Page Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="Reports" Style="{StaticResource PageTitleTextBlockStyle}"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Content="Today" Command="{x:Bind ViewModel.SetDateRangeCommand}" CommandParameter="today"/>
                    <Button Content="Last 7 Days" Command="{x:Bind ViewModel.SetDateRangeCommand}" CommandParameter="week"/>
                    <Button Content="Last 30 Days" Command="{x:Bind ViewModel.SetDateRangeCommand}" CommandParameter="month"/>
                </StackPanel>
            </Grid>

            <!-- Date Range Selector -->
            <StackPanel>
                <TextBlock Text="{x:Bind ViewModel.ReportTitle, Mode=OneWay}" 
                          FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="From:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <CalendarDatePicker Grid.Column="1" Date="{x:Bind ViewModel.StartDate, Mode=TwoWay}" Margin="0,0,16,0"/>
                    
                    <TextBlock Grid.Column="2" Text="To:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <CalendarDatePicker Grid.Column="3" Date="{x:Bind ViewModel.EndDate, Mode=TwoWay}" Margin="0,0,16,0"/>
                </Grid>
                
                <Button Content="Generate Report" 
                       Command="{x:Bind ViewModel.LoadReportsCommand}"
                       Style="{StaticResource AccentButtonStyle}"
                       Margin="0,16,0,0"/>
            </StackPanel>

            <!-- Daily Reports List -->
            <StackPanel Visibility="{x:Bind GetReportsVisibility(ViewModel.DailyReports.Count), Mode=OneWay}">
                <TextBlock Text="Daily Summary" 
                          FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                       BorderThickness="1" CornerRadius="8">
                    
                    <ListView ItemsSource="{x:Bind ViewModel.DailyReports, Mode=OneWay}"
                             SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodels:DailyReportViewModel">
                                <Grid Padding="16,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" 
                                              Text="{x:Bind Date, Converter={StaticResource DateConverter}}"
                                              FontWeight="SemiBold" MinWidth="80"/>
                                    
                                    <TextBlock Grid.Column="1" 
                                              Text="{x:Bind MostUsedApp}"
                                              Margin="16,0"/>
                                    
                                    <TextBlock Grid.Column="2" 
                                              Text="{x:Bind TotalScreenTime, Converter={StaticResource TimeSpanConverter}}"
                                              FontWeight="SemiBold" Margin="16,0"/>
                                    
                                    <TextBlock Grid.Column="3" 
                                              Text="{x:Bind AppsUsedCount}"
                                              Margin="16,0"/>
                                    
                                    <Border Grid.Column="4" 
                                           Background="{x:Bind GetProductivityScoreBrush(ProductivityScore)}"
                                           CornerRadius="8" Padding="8,4" MinWidth="60">
                                        <TextBlock Text="{x:Bind ProductivityScore, Converter={StaticResource ProductivityConverter}}"
                                                  Foreground="White" FontSize="12"
                                                  HorizontalAlignment="Center"/>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        
                        <ListView.Header>
                            <Grid Padding="16,8" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="Date" FontWeight="SemiBold" MinWidth="80"/>
                                <TextBlock Grid.Column="1" Text="Most Used App" FontWeight="SemiBold" Margin="16,0"/>
                                <TextBlock Grid.Column="2" Text="Total Time" FontWeight="SemiBold" Margin="16,0"/>
                                <TextBlock Grid.Column="3" Text="Apps Used" FontWeight="SemiBold" Margin="16,0"/>
                                <TextBlock Grid.Column="4" Text="Productivity" FontWeight="SemiBold" MinWidth="60" HorizontalAlignment="Center"/>
                            </Grid>
                        </ListView.Header>
                    </ListView>
                </Border>
            </StackPanel>

            <!-- Loading Indicator -->
            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                         HorizontalAlignment="Center"
                         Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"/>

            <!-- No Data Message -->
            <Border Visibility="{x:Bind GetNoDataVisibility(ViewModel.DailyReports.Count, ViewModel.IsLoading), Mode=OneWay}"
                   Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                   BorderThickness="1" CornerRadius="8" Padding="32">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="No Data Available" 
                              FontSize="18" FontWeight="SemiBold"
                              HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="Select a date range and click 'Generate Report' to view your screen time data."
                              HorizontalAlignment="Center" TextAlignment="Center"
                              Opacity="0.7"/>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</Page>
