<!-- Copyright (c) Microsoft Corporation and Contributors. -->
<!-- Licensed under the MIT License. -->

<Page
    x:Class="ScreenTimeMonitor.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="using:ScreenTimeMonitor.ViewModels">

    <ScrollViewer>
        <StackPanel Spacing="24" Padding="0,0,0,24">
            
            <!-- Page Header -->
            <TextBlock Text="Dashboard" Style="{StaticResource PageTitleTextBlockStyle}"/>
            
            <!-- Quick Stats Cards -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Total Screen Time Card -->
                <Border Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Screen Time Today" 
                                  FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBlock Text="{x:Bind ViewModel.TotalScreenTimeTodayFormatted, Mode=OneWay}"
                                  FontSize="24" FontWeight="Bold"
                                  Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    </StackPanel>
                </Border>
                
                <!-- Most Used App Card -->
                <Border Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Most Used App Today" 
                                  FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBlock Text="{x:Bind ViewModel.MostUsedAppToday, Mode=OneWay}"
                                  FontSize="20" FontWeight="Bold"
                                  TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Border>
                
                <!-- Currently Active App Card -->
                <Border Grid.Column="2" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Currently Active" 
                                  FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBlock Text="{x:Bind ViewModel.CurrentlyActiveApp, Mode=OneWay}"
                                  FontSize="20" FontWeight="Bold"
                                  TextTrimming="CharacterEllipsis"
                                  Foreground="{ThemeResource SystemAccentColor}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Top Applications -->
            <StackPanel>
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Top Applications Today" 
                              FontSize="20" FontWeight="SemiBold"/>
                    
                    <Button Grid.Column="1" Content="Refresh" 
                           Command="{x:Bind ViewModel.RefreshCurrentDataCommand}"
                           Style="{StaticResource DefaultButtonStyle}"/>
                </Grid>

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                       BorderThickness="1" CornerRadius="8" Padding="0">
                    
                    <ListView ItemsSource="{x:Bind ViewModel.TopAppsToday, Mode=OneWay}"
                             SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodels:AppUsageViewModel">
                                <Grid Padding="16,12" Background="Transparent">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{x:Bind ApplicationName}" 
                                                  FontWeight="SemiBold"/>
                                        <TextBlock Text="{x:Bind Category}" 
                                                  FontSize="12" Opacity="0.7"/>
                                    </StackPanel>
                                    
                                    <TextBlock Grid.Column="1" 
                                              Text="{x:Bind DurationFormatted}"
                                              FontWeight="SemiBold"
                                              Margin="16,0"/>
                                    
                                    <StackPanel Grid.Column="2" MinWidth="60">
                                        <TextBlock Text="{x:Bind Percentage, Converter={StaticResource PercentageConverter}}"
                                                  FontSize="12" HorizontalAlignment="Right"/>
                                        <ProgressBar Value="{x:Bind Percentage}" 
                                                    Maximum="100" Height="4"
                                                    Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
            </StackPanel>

            <!-- Date Selector -->
            <StackPanel>
                <TextBlock Text="View Different Date" 
                          FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>
                
                <CalendarDatePicker Date="{x:Bind ViewModel.SelectedDate, Mode=TwoWay}"
                                   DateChanged="CalendarDatePicker_DateChanged"
                                   HorizontalAlignment="Left"/>
            </StackPanel>

            <!-- Loading Indicator -->
            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                         HorizontalAlignment="Center"
                         Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"/>

        </StackPanel>
    </ScrollViewer>
</Page>
